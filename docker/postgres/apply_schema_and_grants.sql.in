-- Create logical app schema (idempotent)
CREATE SCHEMA IF NOT EXISTS nommie;

-- Grants to the app role
GRANT USAGE, CREATE ON SCHEMA nommie TO :"APP_DB_USER";

GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA nommie TO :"APP_DB_USER";
GRANT USAGE, SELECT, UPDATE ON ALL SEQUENCES IN SCHEMA nommie TO :"APP_DB_USER";

ALTER DEFAULT PRIVILEGES IN SCHEMA nommie
  GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO :"APP_DB_USER";

ALTER DEFAULT PRIVILEGES IN SCHEMA nommie
  GRANT USAGE, SELECT, UPDATE ON SEQUENCES TO :"APP_DB_USER";

-- Ensure app sessions default to the nommie schema
ALTER ROLE :"APP_DB_USER" SET search_path TO nommie;

